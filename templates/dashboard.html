


{% extends "index.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h1 style="color:#00ffff; margin-bottom:30px;">Dashboard - Movie Data Overview</h1>

<div class="row mb-4 align-items-stretch">
    <!-- Total Movies -->
    <div class="col-md-3">
        <div class="card tron-card h-100 mb-3" style="border-top: 4px solid #00ffff;">
            <div class="card-body d-flex flex-column justify-content-center">
                <h5 class="card-title" style="color:#00ffff; min-height:28px;">Total Movies</h5>
                <p class="card-text display-6 text-center" style="color:#00ffff; min-height:40px;">
                    {{ total_movies }}
                </p>
            </div>
        </div>
    </div>

    <!-- Number of Features -->
    <div class="col-md-3">
        <div class="card tron-card h-100 mb-3" style="border-top: 4px solid #39ff14;">
            <div class="card-body d-flex flex-column justify-content-center">
                <h5 class="card-title" style="color:#39ff14; min-height:28px;">Number of Features</h5>
                <p class="card-text display-6 text-center" style="color:#39ff14; min-height:40px;">
                    {{ total_features }}
                </p>
            </div>
        </div>
    </div>

    <!-- Highest Rated Movie -->
    <div class="col-md-3">
        <div class="card tron-card h-100 mb-3" style="border-top: 4px solid #ff00ff;">
            <div class="card-body d-flex flex-column justify-content-center">
                <h5 class="card-title" style="color:#ff00ff; min-height:28px;">Highest Rated Movie</h5>
                <p class="card-text text-center" style="color:#ff00ff; font-size:18px; min-height:40px;">
                    {{ top_movie_title }} ({{ top_movie_rating }})
                </p>
            </div>
        </div>
    </div>

    <!-- Total Reviews -->
    <div class="col-md-3">
        <div class="card tron-card h-100 mb-3" style="border-top: 4px solid #ff4500;">
            <div class="card-body d-flex flex-column justify-content-center">
                <h5 class="card-title" style="color:#ff4500; min-height:28px;">Total Reviews</h5>
                <p class="card-text display-6 text-center" style="color:#ff4500; min-height:40px;">
                    {{ total_reviews }}
                </p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div id="genre_bar" style="width:100%; height:400px;"></div>
    </div>
    <div class="col-md-4">
        <div id="genre_pie" style="width:100%; height:400px;"></div>
    </div>
</div>
<script id="df_data" type="application/json">
    {{ df_json|safe }}
</script>


<script>
    const df = JSON.parse(document.getElementById("df_data").textContent);

    let genreCount = {};

    df.forEach(row => {
        if (!row.Genre) return;

        let genres = row.Genre.split(',').map(g => g.trim());

        genres.forEach(g => {
            if (g.length === 0) return;
            if (!genreCount[g]) genreCount[g] = 0;
            genreCount[g]++;
        });
    });

    const genres = Object.keys(genreCount);
    const counts = Object.values(genreCount);

    // ===== BAR CHART =====
    Plotly.newPlot('genre_bar', [{
        x: genres,
        y: counts,
        type: "bar"
    }], {
        title: "Genre Frequency (Bar Chart)",
        plot_bgcolor: "#111",
        paper_bgcolor: "#111",
        font: { color: "#00ffff" }
    });


    // ===== PIE CHART (Top 5 + Other) =====

    // 1) Chuyển thành list để sort
    let genreList = genres.map((g, i) => ({ genre: g, count: counts[i] }));

    // 2) Sort giảm dần
    genreList.sort((a, b) => b.count - a.count);

    // 3) Lấy top 5
    let top5 = genreList.slice(0, 5);

    // 4) Cộng dồn phần còn lại thành "Other"
    let otherSum = genreList.slice(5).reduce((sum, item) => sum + item.count, 0);

    // 5) Tạo labels + values cho Pie Chart
    let pieLabels = top5.map(item => item.genre);
    let pieValues = top5.map(item => item.count);

    if (otherSum > 0) {
        pieLabels.push("Other");
        pieValues.push(otherSum);
    }

    Plotly.newPlot('genre_pie', [{
        labels: pieLabels,
        values: pieValues,
        type: "pie"
    }], {
        title: "Genre Distribution (Top 5 + Other)",
        plot_bgcolor: "#111",
        paper_bgcolor: "#111",
        font: { color: "#ff00ff" }
    });

</script>


{% endblock %}